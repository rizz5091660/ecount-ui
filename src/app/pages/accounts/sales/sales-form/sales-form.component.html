<nb-card>
  <nb-card-header>
    New {{soFormTitle}}
  </nb-card-header>
  <nb-card-body>
    <form #salesForm="ngForm">
      <div class="row">
        <div class="col-sm-3">
          <label for="custId" class="col-form-label">To</label><br />
          <p-dropdown [options]="model.custSupps" [(ngModel)]="model.custId" [style]="{'width':'150px'}" filter="true" name="model.custId">
              <ng-template let-item pTemplate="selectedItem">
                  <span>{{item.label}}</span>
              </ng-template>
              <ng-template let-cust pTemplate="item">
                  <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                      <div style="font-size:14px;float:left;margin-top:4px">{{cust.label}}</div>
                  </div>
              </ng-template>
          </p-dropdown>
        </div>
        <div class="col-sm-3">
          <label for="soCode" class="col-form-label">{{soFormTitle}} #</label><br />
          <input class="form-control" id="soCode" [(ngModel)]="model.soCode" name="soCode">
        </div>
        <div class="col-sm-3">
          <label for="referrence" class="col-form-label">Referrence</label><br />
          <input class="form-control" id="referrence" [(ngModel)]="model.referrence" name="referrence">
        </div>
      </div>
      <div class="row">
        <div class="col-sm-3">
          <label for="trxnDate" class="col-form-label">Date</label><br />
          <div class="form-group">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="trxnDtNgb" [(ngModel)]="trxnDtNgb"
                ngbDatepicker #d1="ngbDatepicker">
              <div class="input-group-append">
                <button class="btn btn-outline-primary" (click)="d1.toggle()" type="button"></button>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-3">
          <label for="dueDate" class="col-form-label">Due Date</label><br />
          <div class="form-group">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="dueDtNgb" [(ngModel)]="dueDtNgb" ngbDatepicker
                #d2="ngbDatepicker">
              <div class="input-group-append">
                <button class="btn btn-outline-primary" (click)="d2.toggle()" type="button"></button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-2 nb-card-header">Invoice Detail</div>
      </div>
      <div class="row">
          <div class="content-section implementation ui-fluid">
              <p-table [columns]="cols" [value]="model.sods" [paginator]="true" [rows]="10">
                  <ng-template pTemplate="header" let-columns>
                      <tr>
                          <th style="width:25%">Name</th> 
                          <th>Quantity</th> 
                          <th>Price</th> 
                          <th>Account</th> 
                          <th>Tax</th> 
                          <th>Ammount</th>
                          <th style="width:100px">Action</th> 
                      </tr>
                      <tr>
                          <th *ngFor="let col of columns" [ngSwitch]="col.type">
                              <input  *ngSwitchCase="'txt'"  pInputText type="text" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)" style="width:100%">
                              <button *ngSwitchCase="'btn'" type="button" pButton icon="nb-plus" (click)="onAddSod()" style="width:100%"></button>
                          </th>
                      </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-sod let-columns="columns">
                      <tr style="height: 20px">
                          <td pEditableColumn style="width:20%">
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <input pInputText type="text" [(ngModel)]="sod.name" name="sod.name">
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.name}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn>
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <input pInputText type="text" [(ngModel)]="sod.quantity" required name="sod.quantity">
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.quantity}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn>
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <input pInputText type="text" [(ngModel)]="sod.unitPrice" name="sod.unitPrice">
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.unitPrice}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn>
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <p-dropdown [options]="model.coas" [(ngModel)]="sod.coaId" [style]="{'width':'150px'}" filter="true" name="sod.coaId">
                                          <ng-template let-item pTemplate="selectedItem">
                                              <span style="vertical-align:middle; margin-left: .5em">{{item.label}}</span>
                                          </ng-template>
                                          <ng-template let-car pTemplate="item">
                                              <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                                  <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                                              </div>
                                          </ng-template>
                                      </p-dropdown>
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.coaId}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn>
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <input pInputText type="text" [(ngModel)]="sod.taxAmount" name="sod.taxAmount">
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.taxAmount}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn>
                              <p-cellEditor>
                                  <ng-template pTemplate="input">
                                      <input pInputText type="text" [(ngModel)]="sod.txnAmount" name="sod.txnAmount">
                                  </ng-template>
                                  <ng-template pTemplate="output">
                                      {{sod.txnAmount}}
                                  </ng-template>
                              </p-cellEditor>
                          </td>
                          <td pEditableColumn class="td-action">      
                              <div class="div-action">                       
                                <a class="a-action"  href="#"><i class="nb-edit"></i></a>
                                <a class="a-action" href="#"><i class="nb-trash"></i></a>
                             </div>  
                          </td>
                      </tr>
                  </ng-template>
              </p-table>
          </div>          
      </div>
      <div class="form-group row">
        <div class="col-sm-12">
          <ng2-smart-table [settings]="settings" [source]="source" (deleteConfirm)="onDeleteConfirm($event)" (custom)="onCustom($event)">
          </ng2-smart-table>
        </div>
      </div>

      <div class="form-group row">
        <div class="col-sm-6">
        </div>
        <div class="col-sm-2">
          <b>Sub Total</b><br />
          <b>Tax</b><br />
          <b>Total</b><br />
        </div>
        <div class="col-sm-4" style="float:left">
          <b>: {{subTotal}}</b><br />
          <b>: {{model.totalTaxAmount}}</b><br />
          <b>: {{model.totalAmount}}</b><br />
        </div>
      </div>
      <div class="form-group row">
        <div class="col-sm-2">
          <div class="dropdown btn-group" ngbDropdown>
            <button type="button" class="btn btn-primary">Create</button>
            <button type="button" class="btn btn-primary" ngbDropdownToggle></button>
            <ul class="dropdown-menu" ngbDropdownMenu>
              <li class="dropdown-item" (click)="onSave()">Save</li>
              <li class="dropdown-item" (click)="onAwaitApprove()">Submit</li>
              <li class="dropdown-item" (click)="onApprove()">Approve</li>
              <li class="dropdown-item" (click)="onApproveNew()">Approve & Add New</li>
            </ul>
          </div>
        </div>
        <div class="col-sm-2">
          <button type="button" class="btn btn" (click)="onAddSod()" id="newBtn" style="display: none">
          </button>
        </div>
      </div>
    </form>
    <br /><br /><br /><br />
  </nb-card-body>
</nb-card>

<ng-template #modal let-c="close" let-d="dismiss">
  <form #soForm="ngForm">
    <nb-card>
      <nb-card-header>Supplier</nb-card-header>
      <nb-card-body>
        <div class="form-group row">
          <div class="col-md-12">
            <!--
            <ngx-select-dropdown [config]="config" [options]="model.inventories" [multiple]="false" (change)="selectionChanged($event,'inv')"></ngx-select-dropdown>
            -->
          </div>
        </div>
        <div class="form-group row">
          <div class="col-md-3">
            <input class="form-control" type="number" placeholder="Qty" [(ngModel)]="modelSod.quantity" name="modelSod.quantity">
          </div>
          <div class="col-md-5">
            <input class="form-control" type="number" placeholder="Price" [(ngModel)]="modelSod.unitPrice" name="modelSod.unitPrice"
              (blur)="onCalculateTrxn()">
          </div>
          <div class="col-md-4">
            <input class="form-control" type="number" placeholder="Tax" [(ngModel)]="modelSod.taxAmount" name="modelSod.taxAmount"
              (blur)="onCalculateTrxn()">
          </div>
        </div>
        <div class="form-group row">
          <div class="col-md-8">
            <input class="form-control" type="number" placeholder="Amount" [(ngModel)]="modelSod.txnAmount" name="modelSod.txnAmount">
          </div>
        </div>
        <div class="form-group row">
          <div class="col-md-12">
            <button class="btn btn-primary btn-block" (click)="onSubmitSod();d('Cross click');">Submit</button>
          </div>
        </div>
      </nb-card-body>
    </nb-card>
  </form>
</ng-template>